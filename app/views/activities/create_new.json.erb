{
 "success": true,
	 "items": [
	 	{
	 	 xtype: "panel",
	 	 id: 'activities_new',
	 	 title: "New actitity",
	 	 closable: true,
		 layout: {
		    type: 'vbox',
		    align : 'stretch',
		    pack  : 'start',
		 }, 
	 	 items: [ 
			  {
			   xtype: 'form',
			   flex: 1,	      	
			   
			   flex: 1,
				layout: {
				    type: 'vbox',
				    align : 'stretch',
				    pack  : 'start',
				}, 
			     defaults: {
			     	 xtype: 'textfield',
			     	 margin: '10 10 0 10',
			     },	  
			     
			   items: [
			   
			    	<%= raw extjs_std_hiddenfield('id', @item) -%>
			      , <%= raw extjs_std_combo_model('customer', @item) -%>
			      , <%= raw extjs_std_datefield('expiration_date', @item, {:allowBlank=>true, :fieldLabel => 'Data scadenza'}) -%>
			      , <%= raw extjs_std_combo_model('activity_op', @item, 
			      
				      :store => "Ext.create('Ext.data.Store', {
							          model: 'ActivityOp',
							          autoLoad: true,
							          proxy: {
							              type: 'ajax',
							              url: '#{root_path}activity_ops/get_combo_data_escludi_non_usare',
							              extraParams: {
							              },              
							              reader: {
							                  type: 'json',
							                  method: 'POST', 
							                  rootProperty: 'items'                  
							              },
							              paramsAsJson: true,
											method: 'POST',
											type: 'ajax',
								
											//Add these two properties
											actionMethods: {
												read: 'POST'
											},        
							          },          
							      })"
				      ) -%>
			      , <%= raw extjs_std_textareafield('notes', @item) -%>
			      , <%= raw extjs_std_booleanfield('request_received', @item) -%>			      
			    ]
			    
			    
				, buttons: [
					{
			            text: 'Salva',
			            handler: function (btn, evt) {              
			             form = this.up('form').getForm();
			             if (form.isValid()) {
			             
			             
							  Ext.Ajax.request({
				                    url: <%= raw url_for(:controller=>'activities', :action=>'create_new_exe').to_json -%>,
				                    waitMsg: 'Salvataggio in corso....',
									method:'POST',                    
				                    jsonData: {data: form.getValues()},	
				             	
									success: function(result, request) {					
										var returnData = Ext.JSON.decode(result.responseText);
										
										//error
										if (returnData.success == false){
											Ext.MessageBox.show({
						                        title: 'EXCEPTION',
						                        msg: returnData.message,
						                        icon: Ext.MessageBox.ERROR,
						                        buttons: Ext.Msg.OK
					                    	})
					                      return false;										
										}								
						 							
						 				//ok
						 				  Ext.Msg.alert('Message', 'Attivit&agrave; registrata correttamente');
						 				  form.reset();
						 							
									}, scope: this,
									
									failure: function(rec, op) {
										var result = Ext.JSON.decode(op.getResponse().responseText);
										Ext.MessageBox.show({
					                        title: 'EXCEPTION',
					                        msg: result.message,
					                        //icon: Ext.MessageBox.ERROR,
					                        buttons: Ext.Msg.OK
				                    	})					
									}, scope: this,						
													 
						    	});	    
			             
			             }             
			           }
			        }					
				] //buttons
			    
			    
			   }
		 ]
		}	   
	 ]
}