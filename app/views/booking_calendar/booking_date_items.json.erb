[
{html: ''}
<% @items.each do |b| %>
, {
	padding: '1px 1px',
	style: 'background: grey;',
	html: <%= raw "#{b.shipowner.name}/#{b.ship.name}<br/>#{b.num_booking} / #{b.voyage}".to_json -%>,
	//frame: true,
}, {
	xtype: 'panel',
	layout: {
					    type: 'hbox',
					    pack: 'start',
					    align: 'stretch'
					},
	items: [
		{html: ''}	
		<% b.booking_items.each do |bi|
			qb = bi.quantity
			qbu = bi.quantity_used
			ar_by_last_dett = []
		    by_last_dett = bi.get_by_last_dett()
		    by_last_dett.each do |bisk, bisv|
		      ar_by_last_dett << "<br/>#{bisk} #{bisv}"
		    end
		    out_by_last_dett = ar_by_last_dett.join()
			
			c_tmp == by_last_dett[:close]
			if c_tmp == bi.quantity
				c = 'green'
			else
				c_tmp == by_last_dett['I_FILLING']
				if c_tmp == bi.quantity
					c = 'orange'
				else
					c_tmp == by_last_dett['O_FILLING']
					if c_tmp == bi.quantity
						c = 'yellow'
					else
						c = 'red'
					end					
				end	
			end
		 %>
			, {
				html: <%= raw "#{bi.equipment.equipment_type} #{bi.quantity}#{out_by_last_dett}".to_json -%>,
				width: 90,
				bodyStyle: 'background: <%= c -%>; margin: 2px; padding: 2px 5px;'
			},
		<% end %>
		
	]
}
<% end %>
]