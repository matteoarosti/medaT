{
 "success": true,
 "items": [
  {
   xtype: 'form',
      
   <% if op=='UPDATE' %>
   	<%= raw("title:  'Modifica booking',".as_json)  -%>
   	<%= raw("closable: true,".as_json) -%>
   <% end %>	
   
   flex: 1,
	layout: {
	    type: 'vbox',
	    align : 'stretch',
	    pack  : 'start',
	}, 
     defaults: {
     	 xtype: 'textfield',
     	 margin: '10 10 0 10',
     },	  
     
   items: [
   
    <%= raw extjs_std_hiddenfield('id', @item) -%>,
    <%= raw extjs_std_textfield('num_booking', @item) -%>,
    <%= raw extjs_fieldcontainer('', {}, [
		extjs_std_combo_model('shipowner', @item),
		extjs_std_combo_model('ship', @item, {}, fcR {})]) -%>,
	<%= raw extjs_std_combo_model('equipment', @item) -%>, 
	<%= raw extjs_std_combo_model('port', @item) -%>,
	<%= raw extjs_std_datefield('eta', @item, :allowBlank => true) -%>,
	<%= raw extjs_std_textfield('quantity', @item) -%>,
	<%= raw extjs_std_textareafield('notes', @item) -%>,
        
    <%= raw extjs_fieldcontainer('', {}, [
    								extjs_std_combo('status', @item, :store => extjs_std_store_data(@item.status_get_data_json)),
    								extjs_std_booleanfield('to_check', @item, {}, fcR)]) -%>,
    
    <%= raw extjs_std_datefield('expiration', @item, :allowBlank => true) -%>     		
   ],
   
   
	buttons:
        [{
            text: 'Salva',
            handler: function (btn, evt) {              
             form = this.up('form').getForm();
             if (form.isValid()) {
             	new_rec = Ext.create('Booking', {});
             	new_rec.data = form.getValues();
             	new_rec.save({
					success: function(rec, op) {
					
   <% if op=='CREATE' %>					 										
					 this.up('window').close();
   <% end %>				 	
   
   <% if op=='UPDATE' %>					 										
					 this.up('form').close();
   <% end %>					 							
					}, scope: this,				
					
					failure: function(rec, op) {
						var result = Ext.JSON.decode(op.getResponse().responseText);
						Ext.MessageBox.show({
	                        title: 'EXCEPTION',
	                        msg: result.message,
	                        icon: Ext.MessageBox.ERROR,
	                        buttons: Ext.Msg.OK
                    	})					
					}, scope: this,					
					 
		    	});
             }             
            }
        }]   
  }
 ]
}