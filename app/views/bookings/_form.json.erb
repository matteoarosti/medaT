{
 "success": true,
 "items": [
  {
   xtype: 'form',
      
   <% if op=='UPDATE' %>
   	<%= raw("title:  'Modifica booking',".as_json)  -%>
   	<%= raw("closable: true,".as_json) -%>
   <% end %>	
   flex: 1,
	layout: {
	    type: 'vbox',
	    align : 'stretch',
	    pack  : 'start',
	}, 
     defaults: {
     	 xtype: 'textfield',
     	 margin: '10 10 0 10',
     },	  
     
   items: [
    {xtype: 'hiddenfield', name: 'id', value: '<%= @item.id -%>'},
    {xtype: 'textfield', fieldLabel: 'Booking', name: 'num_booking', value: '<%= @item.num_booking -%>', maxLength: 15, allowBlank: false},        
	{
		xtype: 'combobox', name: 'shipowner_id', value: <%= raw @item.shipowner_id.to_json -%>, 
		fieldLabel: 'Compagnia',
		displayField : 'name',
		valueField:  'id',
		forceSelection: true,
		allowBlank: false,
		triggerAction: 'all',  
		
			store: Ext.create('Ext.data.Store', {
			    model: 'Shipowner',
			    autoLoad: true,
			    proxy: {
			        type: 'ajax',
			        url: '/shipowners/get_combo_data',			        
			        reader: {
			            type: 'json'
			        }       
			    },			    
			}), 
			
			listeners: {
			        afterrender: function(comp){
			        	//comp.setValue(333);
			        	//comp.setRawValue('sssss');
			        },
			    }
		},
    {xtype: 'textfield', fieldLabel: 'Viaggio', name: 'voyage', value: '<%= @item.voyage -%>', maxLength: 15, allowBlank: false},
	{
		xtype: 'combobox', name: 'equipment_id', value: <%= raw @item.equipment_id.to_json -%>,
		fieldLabel: 'Tipo Container',
		displayField : 'sizetype',
		valueField:  'id',
		forceSelection: true,
		allowBlank: false,
		triggerAction: 'all',  
		
			store: Ext.create('Ext.data.Store', {
			    model: 'Equipment',
			    autoLoad: true,
			    proxy: {
			        type: 'ajax',
			        url: '/equipment/get_combo_data',			        
			        reader: {
			            type: 'json'
			        }       
			    },			    
			}), 											  
		},  
	{
		xtype: 'combobox', name: 'port_id', value: <%= raw @item.port_id.to_json -%>,
		fieldLabel: 'Destinazione',
		displayField : 'port_code',
		valueField:  'id',
		forceSelection: true,
		allowBlank: false,
		triggerAction: 'all',  
		
			store: Ext.create('Ext.data.Store', {
			    model: 'Port',
			    autoLoad: true,
			    proxy: {
			        type: 'ajax',
			        url: '/ports/get_combo_data',			        
			        reader: {
			            type: 'json'
			        }       
			    },			    
			}), 											  
		},
	{xtype: 'datefield', fieldLabel: 'ETA', name: 'eta', value: '<%= @item.eta -%>', allowBlank: false},
	{xtype: 'textfield', fieldLabel: 'Quantit√†', name: 'quantity', value: '<%= @item.quantity -%>', allowBlank: false}	
    		
   ],
   
   
	buttons:
        [{
            text: 'Salva',
            handler: function (btn, evt) {              
             form = this.up('form').getForm();
             if (form.isValid()) {
             	new_rec = Ext.create('Booking', {});
             	new_rec.data = form.getValues();
             	new_rec.save({
					success: function(rec, op) {
					
   <% if op=='CREATE' %>					 										
					 this.up('window').close();
   <% end %>				 	
   
   <% if op=='UPDATE' %>					 										
					 this.up('form').close();
   <% end %>					 							
					}, scope: this,				 
		    	});
             }             
            }
        }]   
  }
 ]
}