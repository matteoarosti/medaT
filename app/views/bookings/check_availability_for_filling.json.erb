{
 "success": true,
 "items": [
  {
   xtype: 'form',
   flex: 1,
	layout: {
	    type: 'vbox',
	    align : 'stretch',
	    pack  : 'start',
	}, 
     defaults: {
     	 xtype: 'textfield',
     	 margin: '10 10 0 10',
     },	  
     
   items: [
   	<%= raw extjs_std_textfield('num_booking', @item,  {allowBlank: false}) -%>,
   	<%= raw extjs_std_combo_model('equipment', @itemI, {allowBlank: false, fieldLabel: 'Tipologia'}) -%>,
   	<%= raw extjs_std_numberfield('quantity',  @itemI, {allowBlank: false, fieldLabel: 'Quantit&agrave;'}) -%>
   ],   
   
	buttons:[
		{
            text: 'Verifica',
            handler: function (btn, evt) {              
              form = this.up('form').getForm();
              if (form.isValid()) {
             	btn.disable();
					Ext.Ajax.request({
	                    url: <%= raw url_for(:controller=>'bookings', :action=>'check_availability_for_filling_exe').to_json -%>,
	                    waitMsg: 'Salvataggio in corso....',
						method:'POST',                    
	                    jsonData: {data: form.getValues()},	
	             	
						success: function(result, request) {
							btn.enable();					
							var returnData = Ext.JSON.decode(result.responseText);
							
							//esito negativo (container non disponibile per uscita)
							if (returnData.success == false){
								Ext.MessageBox.show({
			                        title: 'Verifica negativa',
			                        msg: returnData.message,
			                        icon: Ext.MessageBox.ERROR,
			                        buttons: Ext.Msg.OK
		                    	})
		                      return false;										
							}								
			 							
							//esito positivo
							if (returnData.success == true){
								Ext.MessageBox.show({
			                        title: 'Verifica positiva',
			                        msg: returnData.message,
			                        icon: Ext.MessageBox.SUCCESS,
			                        buttons: Ext.Msg.OK
		                    	})
		                      return false;										
							}								
			 							
						}, scope: this,
						
						failure: function(rec, op) {
							btn.enable();
							var result = Ext.JSON.decode(op.getResponse().responseText);
							Ext.MessageBox.show({
		                        title: 'EXCEPTION',
		                        msg: 'ATTENZIONE: si &egrave; verificato un errore nella richiesta',
		                        buttons: Ext.Msg.OK
	                    	})					
						}, scope: this,						
										 
			    	});             	
              }
            } 
        }
	]
	
  }
 ]
}