{
 "success": true,
 "items": [
  {
   xtype: 'form',
   flex: 1,
	layout: {
	    type: 'vbox',
	    align : 'stretch',
	    pack  : 'start',
	}, 
     defaults: {
     	 xtype: 'textfield',
     	 margin: '10 10 0 10',
     },	  
     
   items: [
   
		{
            xtype: 'radiogroup',
            fieldLabel: 'Stato import',
            layout: 'hbox',
            items: [{
                boxLabel: 'Aperto',
                name: 'import_status',
                inputValue: 'OPEN',
                checked: true,
                width: 150                
            }, {
                boxLabel: 'Chiuso',
                name: 'import_status',
                inputValue: 'CLOSE'
            }],
            
			listeners: {
			        change: function(field, newValue, oldValue) {
			          this.up('form').refresh_voyage_combo();
			        }
			    }            
        },
   
   
       
	{
		xtype: 'combobox', name: 'ship_id',
		fieldLabel: 'Nave',
		displayField : 'name',
		valueField:  'id',
		forceSelection: true,
		allowBlank: false,
		triggerAction: 'all',  
		
			store: Ext.create('Ext.data.Store', {
			    model: 'Shipowner',
			    proxy: {
			        autoload: true,
			        type: 'ajax',
			        url: '/ships/get_combo_data',
			        reader: {
			            type: 'json'
			        }       
			    },			    
			}), 
			
		listeners: {
		    change: function(combo, record, index) {
			  this.up('form').refresh_voyage_combo();			  
		    }
		  }													  
		},
		
   
   	{
		xtype: 'combobox', name: 'voyage',
		fieldLabel: 'Vojage',
		displayField : 'voyage',
		valueField:  'voyage',
		forceSelection: true,
		allowBlank: false,
		triggerAction: 'all',  
		
			store: Ext.create('Ext.data.Store', {
			    fields: [],
			    autoLoad: false,			    
			    proxy: {
			        actionMethods: {read: 'POST'},
			        extraParams: {},
			        type: 'ajax',
			        url: '/import_headers/get_voyage_by_ship',
			        reader: {
			            type: 'json',
			            rootProperty: 'items'
			        }       
			    },			    
			}), 											  
		},        
   ],
   
   
	buttons:
        [{
            text: 'Apri',
            handler: function (btn, evt) {              
             form = this.up('form').getForm();
             win  = this.up('window');
             if (form.isValid()) {

				//invio la richiesta per verificare se esiste
					form.submit({
	                        url: '<%= url_for(:action=>'search_import') -%>',
	                        waitMsg: 'Ricerca in corso....',
	                        success: function(fp, o) {
	                        	win.close();
	                            acs_show_panel_std(myApp, '<%= url_for(:action=>'open_import') -%>', {import_header_id: o.result.import_id}, 'Import');
	                        },
							failure: function(fp, o) {
	                            Ext.Msg.alert('Import non trovato', 'Modfificare i parametri e ripetere la richiesta');	                            
	                        }	                        
	                    });				
				
             }             
            }
        }],
        
    refresh_voyage_combo: function(){
		      field_voyage = this.getForm().findField('voyage');
		      field_voyage.getStore().proxy.extraParams =  this.getForm().getValues();
		      field_voyage.getStore().load();
    }    
  }
 ]
}