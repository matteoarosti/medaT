{
 success: true,
 items: [
 {
  xtype: 'container',
  itemId: 'tab_panel',
  closable: true,
  title: 'Repair',
  flex: 1,
    layout: {
	    type: 'vbox',
	    pack: 'start',
	    align: 'stretch'
	},


	viewModel: {
			data: {
				rec: <%= raw @item.to_json(RepairHandlingItem.as_json_prop) -%>,
				enable_operations: <%= raw @item.enable_operations_list.to_json -%>
			}
			
			, test_with_note: function(note){
			  			cls = 'fa fa-2x fa-file-text-o';
    		        	 if (Ext.isEmpty(note) == false)
    		        	 	cls = cls + " with-note";
    		        	  else
    		        		cls = cls + " with-no-note";    
    		        	
    		        	return cls;			  
			}
			
    		, formulas: {    		    			  

    		        with_note_in_garage:{
    		          bind: {bindTo: '{rec}'},
    		          get: function (rec) {
    		            return this.test_with_note(rec.in_garage_notes)
    		        }
    		       },
    		        with_note_estimate:{
    		          bind: {bindTo: '{rec}'},
    		          get: function (rec) {
    		            return this.test_with_note(rec.estimate_notes)
    		        }
    		       },
    		        with_note_estimate_sent:{
    		          bind: {bindTo: '{rec}'},
    		          get: function (rec) {
    		            return this.test_with_note(rec.estimate_sent_notes)
    		        }
    		       },
    		        with_note_estimate_authorized:{
    		          bind: {bindTo: '{rec}'},
    		          get: function (rec) {
    		            return this.test_with_note(rec.estimate_authorized_notes)
    		        }
    		       },
    		        with_note_repair_completed:{
    		          bind: {bindTo: '{rec}'},
    		          get: function (rec) {
    		            return this.test_with_note(rec.repair_completed_notes)
    		        }
    		       },
    		        with_note_out_garage:{
    		          bind: {bindTo: '{rec}'},
    		          get: function (rec) {
    		            return this.test_with_note(rec.out_garage_notes)
    		        }
    		       }
    		       
    		       
    		       
    		       
    		       
    		
    		} //formulas
			
			    			
	},    


  items: [
  
     //INTESTAZIONE (CONTAINER, EQUIPMENT, ....)
	{
	  xtype: 'panel',
	  border: true,
	    layout: {
		    type: 'hbox',
		    pack: 'start',
		    align: 'stretch'
		},
			
	  items: [
	     {
			xtype: 'fieldcontainer',
	                layout: 'hbox',
	                anchor: '100%',
	                bodyStyle: 'background-color: #e0e0e0;',
	                defaults: {labelAlign: 'top', xtype: 'displayfield', width: 150, margin: '5 10 5 10'},
	                items: [	  	 
					     <%= raw "{flex: 1, fieldLabel: 'Container', value: #{@item.handling_header.container_number.to_json}}" -%>,
						 <%= raw "{flex: 1, fieldLabel: 'Compagnia', value: #{@item.handling_header.shipowner.name.to_json}}" -%>,	     
					     <%= raw "{flex: 1, fieldLabel: 'Equipment', value: #{@item.handling_header.equipment.equipment_type.to_json}}" -%>
				    ]
		}
		
		<% if @item.handling_header.equipment.reefer %>
		  , {html: <%= raw "<h1><font size=2>PTI RICHIESTA:</font>  #{@item.pti_type_requested.name if !@item.pti_type_requested.nil?}</h1>".to_json -%>}
		  , {html: '&nbsp;&nbsp;&nbsp;&nbsp;'}
		  , {xtype: 'panel', bind: {html: '<H1><font size=2>PTI CONFERMATA:</font> {rec.pti_type_confirmed_name}</h1>'}}		
		<% end %>
		

	  ]
	} //INTESTAZIONE
	
	, 
	
	//TABLE LAYOUT (3 columns)
	{
	  xtype: 'panel',
	  flex: 1,
	    layout: {
		    type: 'table',
		    columns: 3,
		    tableAttrs: {
		        style: {
		            width: '100%',
		            height: '100%'
		        }
    		}
		},
		
        defaults: {
			xtype: 'panel', border: false,     
            // applied to each contained panel
            bodyStyle:'padding:10px; border: 0px;',
            style: 'margin: 10px; padding: 10px; border: 1px solid grey; border-top: 10px solid grey;',
            border: true,
			layout: {
				    type: 'vbox',
				    pack: 'start',
				    align: 'stretch'
			}
            
        },		
	
	  items: [

			//IN GARAGE
			{
			  bodyStyle:'padding:0px; border: 0px;',			  			  			
			  style: 'margin: 10px; margin-top: 0px; margin-bottom: 0px; padding: 10px; padding-top: 0px; border: 1px solid grey; border-top: 10px solid grey;',
			  items: [
				{html: '<h2>Ingresso in officina</h2>'},
				{xtype: 'textfield', fieldLabel: 'Portato il', bind: '{rec.in_garage_at:date("d/m/Y H:i")}'},
				{xtype: 'textfield', fieldLabel: 'Portato da', bind: '{rec.in_garage_user_name}'},
				{xtype: 'displayfield', fieldLabel: 'Ultimo mov',
					value: '<%= 
				 				hi_t = @item.handling_item.search_hi_by_operation_type('MT')
				 				hi_t.nil? ? '?' : I18n.t("operations.#{hi_t.handling_item_type}.short")
				 			 -%>'
				}
			  ]
			  
        	  , dockedItems: [
        	   { 
        	    defaults: {scale: 'medium'},
        	    xtype: 'toolbar', dock: 'bottom',
        	    items: [
						{iconCls: '', text: 'Imposta/Modifica', bind: {disabled: '{!enable_operations.in_garage_modify}'}, 
							handler: function(event, toolEl, panel){ 
				 			}
				 		},
				 		{xtype: 'tbfill'}
				 		
				 		, {scale: 'medium', cls: 'btn', iconCls: 'fa fa-2x fa-bars', text: '', tooltip: 'Apri movimento',
				 			handler: function(event, toolEl, panel){
									new_rec = HandlingHeader.load(<%= @item.handling_header.id -%>);
							        newPanel = Ext.create('FeedViewer.MovimentoPanel', {
										title: 'Mov. ' + <%= raw @item.handling_header.container_number.to_s.to_json -%>,
										closable: true			
							        });
							        
			                		newPanel.getViewModel().setData({rec: new_rec, 
			                			is_handling_editable: false,
			                			is_container_editable: false
			                		});
			                    	myApp.feedInfo.add(newPanel).show();
						            myApp.feedInfo.setActiveTab(myApp.feedInfo.items.length - 1);				 			
				 			}
				 		}				 		
				 		
				 		, {scale: 'medium', cls: 'btn-ok', iconCls: 'fa fa-2x fa-thumbs-o-up', text: '', 
				 			bind: {visible: '{rec.in_garage_at}'}
				 		},{scale: 'medium', cls: '', iconCls: '', text: '', bind: {iconCls: '{with_note_in_garage}'},
					 		handler: function(event, toolEl, panel){
                            	acs_show_win_std('Modifica nota', myApp.railsBaseUri + 'repair_handling_items/edit_notes',
     			                		 {rec_id: <%= @item.id -%>, note_field: 'in_garage_notes', datetime_field: 'in_garage_at'},
     			                		 600, 300);
					 			 
					 		}
				 		}	        	    
        	    ]
        	   }
        	  ]
			  
			} //IN GARAGE



			//PREVENTIVO REDATTO
			, {		
			  colspan: 1,	  			  			
			  items: [
				{html: '<h2>Redazione preventivo</h2>'},
				{xtype: 'textfield', fieldLabel: 'Redatto il', bind: '{rec.estimate_at:date("d/m/Y H:i")}'},
				{xtype: 'textfield', fieldLabel: 'Redatto da', bind: '{rec.estimate_user_name}'}
			  ]
			  
        	  , dockedItems: [
        	   { 
        	    defaults: {scale: 'medium'},        	   
        	    xtype: 'toolbar', dock: 'bottom',
        	    items: [
        	            	    
						{iconCls: '',  text: 'Inserisci', bind: {disabled: '{!enable_operations.estimate_modify}'},
						
						    handler: function(event, toolEl, panel){

			 				my_listeners = {
		                		onConfirm: function(fromWindow){

									Ext.Ajax.request({
					                    url: <%= raw url_for(:controller=>'repair_handling_items', :action=>'set_estimate').to_json -%>,
					                    waitMsg: 'Salvataggio in corso....',
										method:'POST',                     
					                    jsonData: {rec_id: <%= @item.id -%>},	
					             	
										success: function(result, request) {					
											var returnData = Ext.JSON.decode(result.responseText);
	
											if (returnData.success == false){
												Ext.MessageBox.show({
							                        title: 'EXCEPTION',
							                        msg: returnData.message,
							                        icon: Ext.MessageBox.ERROR,
							                        buttons: Ext.Msg.OK
						                    	})
						                      return false;										
											}
											
											//aggiorno il record per il bind e operation_list
											tab_panel = this.up('container[itemId=tab_panel]');
											rec = returnData.data[0];																				
											tab_panel.getViewModel().setData({rec: rec});
											tab_panel.getViewModel().setData({enable_operations: returnData.enable_operations});
											fromWindow.close();
										}, scope: this,
										
										failure: function(rec, op) {
											alert('error');
											var result = Ext.JSON.decode(op.getResponse().responseText);
											Ext.MessageBox.show({
						                        title: 'EXCEPTION',
						                        msg: result.message,
						                        icon: Ext.MessageBox.ERROR,
						                        buttons: Ext.Msg.OK
					                    	})					
										}, scope: this,						
														 
							    	});


		                			

		                		}, scope: this		                		
		                	}

						    
						     new_win = acs_show_win_std('Dettaglio Preventivo', <%= raw url_for(:controller=>'repair_handling_items', :action=>'estimate_edit').to_json -%>,
				     	 		{rhi_id: <%= @item.id -%>},
				     	 		900, 650, my_listeners, null, 'Y');										
						     
						    },
						
				 		}, {iconCls: '',  text: 'Visualizza',
							handler: function(event, toolEl, panel){
							 my_listeners = {}
						     new_win = acs_show_win_std('Dettaglio Preventivo', <%= raw url_for(:controller=>'repair_handling_items', :action=>'estimate_edit').to_json -%>,
				     	 		{rhi_id: <%= @item.id -%>, only_view: 'Y'},
				     	 		900, 650, my_listeners, null, 'Y');										
							  
				 			}
				 		}, {scale: 'medium', cls: '', iconCls: 'fa fa-2x fa-print', text: '', 
				 			bind: {visible: '{rec.estimate_at}'},
				 			handler: function(event, toolEl, panel){
							 my_listeners = {}
						     new_win = acs_show_win_std('Parametri di stampa', <%= raw url_for(:controller=>'repair_handling_items', :action=>'print_estimate_open_params').to_json -%>,
				     	 		{rhi_id: <%= @item.id -%>},
				     	 		400, 400, my_listeners);										
							  
				 			}
				 		}, {xtype: 'tbfill'},{scale: 'medium', cls: 'btn-ok', iconCls: 'fa fa-2x fa-thumbs-o-up', text: '', 
				 			bind: {visible: '{rec.estimate_at}'}
				 		},{scale: 'medium', cls: '', iconCls: '', text: '', bind: {iconCls: '{with_note_estimate}'},
					 		handler: function(event, toolEl, panel){
                            	acs_show_win_std('Modifica nota', myApp.railsBaseUri + 'repair_handling_items/edit_notes',
     			                		 {rec_id: <%= @item.id -%>, note_field: 'estimate_notes', datetime_field: 'estimate_at'},
     			                		 600, 300);					 			 
					 		}				 		
				 		}
				 		
        	    ]
        	   }
        	  ]
			  
			} //REDATTO
		

		
		
		

			//INVIATO A COMPAGNIA
			, {		
			  colspan: 1,	  			  			
			  items: [
				{html: '<h2>Inviato a compagnia</h2>'},
				{xtype: 'textfield', fieldLabel: 'Inviato il', bind: '{rec.estimate_sent_at:date("d/m/Y H:i")}'},
				{xtype: 'textfield', fieldLabel: 'Inviato da', bind: '{rec.estimate_sent_user_name}'}
			  ]
			  
        	  , dockedItems: [
        	   { 
        	    defaults: {scale: 'medium'},        	   
        	    xtype: 'toolbar', dock: 'bottom',
        	    items: [
						{iconCls: '',  text: 'Inviato', bind: {disabled: '{!enable_operations.estimate_sent_modify}'},				 		
							handler: function(event, toolEl, panel){
							  Ext.MessageBox.confirm('Richieta conferma', 'Confermi operazione?', function(btn){
							   if(btn === 'yes'){
								Ext.Ajax.request({
				                    url: <%= raw url_for(:controller=>'repair_handling_items', :action=>'set_estimate_sent').to_json -%>,
				                    waitMsg: 'Salvataggio in corso....',
									method:'POST',                     
				                    jsonData: {rec_id: <%= @item.id -%>},	
				             	
									success: function(result, request) {					
										var returnData = Ext.JSON.decode(result.responseText);

										if (returnData.success == false){
											Ext.MessageBox.show({
						                        title: 'EXCEPTION',
						                        msg: returnData.message,
						                        icon: Ext.MessageBox.ERROR,
						                        buttons: Ext.Msg.OK
					                    	})
					                      return false;										
										}
										
										//aggiorno il record per il bind e operation_list
										tab_panel = this.up('container[itemId=tab_panel]');
										rec = returnData.data[0];																				
										tab_panel.getViewModel().setData({rec: rec});
										tab_panel.getViewModel().setData({enable_operations: returnData.enable_operations});
									}, scope: this,
									
									failure: function(rec, op) {
										alert('error');
										var result = Ext.JSON.decode(op.getResponse().responseText);
										Ext.MessageBox.show({
					                        title: 'EXCEPTION',
					                        msg: result.message,
					                        icon: Ext.MessageBox.ERROR,
					                        buttons: Ext.Msg.OK
				                    	})					
									}, scope: this,						
													 
						    	});							   
							   } //btn == 'yes'
							  }, this); 

				 			}
				 		}, {xtype: 'tbfill'},{scale: 'medium', cls: 'btn-ok', iconCls: 'fa fa-2x fa-thumbs-o-up', text: '', 
				 			bind: {visible: '{rec.estimate_sent_at}'}
				 		},{scale: 'medium', cls: '', iconCls: '', text: '', bind: {iconCls: '{with_note_estimate_sent}'},
					 		handler: function(event, toolEl, panel){
                            	acs_show_win_std('Modifica nota', myApp.railsBaseUri + 'repair_handling_items/edit_notes',
     			                		 {rec_id: <%= @item.id -%>, note_field: 'estimate_sent_notes', datetime_field: 'estimate_sent_at'},
     			                		 600, 300);					 			 
					 		}				 		
				 		}
				 		
        	    ]
        	   }
        	  ]
			  
			} //INVIATO A COMPAGNIA
		
		
		
		



			//AUTORIZZATO (da shipowner)
			, {			  			  			
			  items: [
				{html: '<h2>Autorizzazione del preventivo</h2>'},
				{xtype: 'textfield', fieldLabel: 'Autorizzato il', bind: '{rec.estimate_authorized_at:date("d/m/Y H:i")}'},
				{xtype: 'textfield', fieldLabel: 'Autorizzato da', bind: '{rec.estimate_authorized_user_name}'}
			  ]
			  
        	  , dockedItems: [
        	   { 
        	    defaults: {scale: 'medium'},        	   
        	    xtype: 'toolbar', dock: 'bottom',
        	    items: [
        	    
						{iconCls: '',  text: 'Autorizza/modifica', bind: {disabled: '{!enable_operations.estimate_authorized_modify}'},
						
						    handler: function(event, toolEl, panel){

			 				my_listeners = {
		                		onConfirm: function(fromWindow, send_email){

									if (send_email == 'N') 
										fl_send_email = 'N' 
									else 
										fl_send_email = 'Y';

									Ext.Ajax.request({
					                    url: <%= raw url_for(:controller=>'repair_handling_items', :action=>'set_authorized').to_json -%>,
					                    timeout: 24000000,
					                    waitMsg: 'Salvataggio in corso....',
										method:'POST',                     
					                    jsonData: {
					                    	rec_id: <%= @item.id -%>,
					                    	fl_send_email: fl_send_email
					                    },	
					             	
										success: function(result, request) {					
											var returnData = Ext.JSON.decode(result.responseText);
	
											if (returnData.success == false){
												Ext.MessageBox.show({
							                        title: 'EXCEPTION',
							                        msg: returnData.message,
							                        icon: Ext.MessageBox.ERROR,
							                        buttons: Ext.Msg.OK
						                    	})
						                      return false;										
											}
											
											//aggiorno il record per il bind e operation_list
											tab_panel = this.up('container[itemId=tab_panel]');
											rec = returnData.data[0];																				
											tab_panel.getViewModel().setData({rec: rec});
											tab_panel.getViewModel().setData({enable_operations: returnData.enable_operations});
											fromWindow.close();
										}, scope: this,
										
										failure: function(rec, op) {
											alert('error');
											var result = Ext.JSON.decode(op.getResponse().responseText);
											Ext.MessageBox.show({
						                        title: 'EXCEPTION',
						                        msg: result.message,
						                        icon: Ext.MessageBox.ERROR,
						                        buttons: Ext.Msg.OK
					                    	})					
										}, scope: this,						
														 
							    	});


		                			

		                		}, scope: this		                		
		                	}

						    
						     new_win = acs_show_win_std('Dettaglio Preventivo', <%= raw url_for(:controller=>'repair_handling_items', :action=>'estimate_edit').to_json -%>,
				     	 		{rhi_id: <%= @item.id -%>, authorizing: 'Y'},
				     	 		900, 650, my_listeners);										
						     
						    },
						
				 		}, {xtype: 'tbfill'},{scale: 'medium', cls: 'btn-ok', iconCls: 'fa fa-2x fa-thumbs-o-up', text: '', 
				 			bind: {visible: '{rec.estimate_authorized_at}'}
				 		}, {scale: 'medium', cls: '', iconCls: '', text: '', bind: {iconCls: '{with_note_estimate_authorized}'},
					 		handler: function(event, toolEl, panel){
                            	acs_show_win_std('Modifica nota', myApp.railsBaseUri + 'repair_handling_items/edit_notes',
     			                		 {rec_id: <%= @item.id -%>, note_field: 'estimate_authorized_notes', datetime_field: 'estimate_authorized_at'},
     			                		 600, 300);					 			 
					 		}				 		
				 		}        	    
        	    ]
        	   }
        	  ]
			  
			} //AUTORIZZATO
		
		
		
		

			//CONTAINER RIPARATO
			, {			  			  			
			  items: [
				{html: '<h2>Riparazione eseguita</h2>'},
				{xtype: 'textfield', fieldLabel: 'Riparato il', bind: '{rec.repair_completed_at:date("d/m/Y H:i")}'},
				{xtype: 'textfield', fieldLabel: 'Riparato da', bind: '{rec.repair_completed_user_name}'}
			  ]
			  
        	  , dockedItems: [
        	   { 
        	    defaults: {scale: 'medium'},        	   
        	    xtype: 'toolbar', dock: 'bottom',
        	    items: [
						{iconCls: '', text: 'Imposta/Modifica', bind: {disabled: '{!enable_operations.repair_completed_modify}'},
							handler: function(event, toolEl, panel){
							
							
							  //se e' un frigo chiedo quale tipo di PTI e' stato eseguito (short, long, visual, ....)
							  
							  <% if @item.handling_header.equipment.reefer ################################### %>
							  
							        var tab_panel = this.up('container[itemId=tab_panel]');
							        
									var loc_form = Ext.create('Ext.form.Panel', {
										    title: '',
										    bodyPadding: 10,
										    defaultType: 'textfield',
										    	layout: {
												    type: 'vbox',
												    align : 'stretch',
												    pack  : 'start',
												},
										    items: [
										       {xtype: 'hiddenfield', name: 'rec_id', value: <%= @item.id -%>},
										       <%= raw extjs_std_combo_model('pti_type_confirmed', @item, {model_class: 'pti_type'}) -%>
										    ]
										    , 	buttons:
											        [{
											            text: 'Conferma',
											            handler: function (btn, evt) { 
											                           
											             var form = this.up('form').getForm();
											             var tmp_win  = this.up('window');
											             											             
											             if (form.isValid()) {
											                btn.disable();											             
															Ext.Ajax.request({
															   method: 'POST',
															   url: '<%= url_for(:controller=>'repair_handling_items', :action=>'set_repair_completed') -%>',
															   jsonData: form.getValues(),															   
															   success: function(result, request) {
															   	  var returnData = Ext.JSON.decode(result.responseText);
															   	  
															   	  if (returnData.success == false){
																	Ext.MessageBox.show({
												                        title: 'EXCEPTION',
												                        msg: returnData.message,
												                        icon: Ext.MessageBox.ERROR,
												                        buttons: Ext.Msg.OK
											                    	})															   	  
															   	  } else {		
															   	      tmp_win.close();														      
																	  var rec = returnData.data[0];																				
																	  tab_panel.getViewModel().setData({rec: rec});
																	  tab_panel.getViewModel().setData({enable_operations: returnData.enable_operations});															   	  
															   	  }															   	 
															   },
															   failure: function(response, opts) {
															      console.log('server-side failure with status code ' + response.status);
																	Ext.MessageBox.show({
												                        title: 'EXCEPTION',
												                        msg: 'Errore sconosciuto',
												                        icon: Ext.MessageBox.ERROR,
												                        buttons: Ext.Msg.OK
											                    	})															   	  															      
															   }

															});	
														  return false;												             
											             }
											            }
											          }
											         ]
  
										});	 //loc_form
										
										var loc_win = Ext.create('Ext.window.Window',{
										    layout: 'fit',
										    items: loc_form,
										    title: 'Conferma riparazione frigo',
										    width: 500,
										    height: 300
										}).show();						  
							  
							     
							  <% else                                      ################################### %>
							  	//richiedo semplice conferma
								  Ext.MessageBox.confirm('Richieta conferma', 'Confermi operazione?', function(btn){
								   if(btn === 'yes'){
									Ext.Ajax.request({
					                    url: <%= raw url_for(:controller=>'repair_handling_items', :action=>'set_repair_completed').to_json -%>,
					                    waitMsg: 'Salvataggio in corso....',
										method:'POST',                     
					                    jsonData: {rec_id: <%= @item.id -%>},	
					             	
										success: function(result, request) {					
											var returnData = Ext.JSON.decode(result.responseText);
	
											if (returnData.success == false){
												Ext.MessageBox.show({
							                        title: 'EXCEPTION',
							                        msg: returnData.message,
							                        icon: Ext.MessageBox.ERROR,
							                        buttons: Ext.Msg.OK
						                    	})
						                      return false;										
											}
											
											//aggiorno il record per il bind e operation_list
											tab_panel = this.up('container[itemId=tab_panel]');
											rec = returnData.data[0];																				
											tab_panel.getViewModel().setData({rec: rec});
											tab_panel.getViewModel().setData({enable_operations: returnData.enable_operations});
										}, scope: this,
										
										failure: function(rec, op) {
											alert('error');
											var result = Ext.JSON.decode(op.getResponse().responseText);
											Ext.MessageBox.show({
						                        title: 'EXCEPTION',
						                        msg: result.message,
						                        icon: Ext.MessageBox.ERROR,
						                        buttons: Ext.Msg.OK
					                    	})					
										}, scope: this,						
														 
							    	});							   
								   } //btn == 'yes'
								  }, this); 							  
							  <% end ######################################################################### %>
							  
							
							


				 			} //handler
				 		},
				 		{xtype: 'tbfill'},{scale: 'medium', cls: 'btn-ok', iconCls: 'fa fa-2x fa-thumbs-o-up', text: '', 
				 			bind: {visible: '{rec.repair_completed_at}'}
				 		}, {scale: 'medium', cls: '', iconCls: '', text: '', bind: {iconCls: '{with_note_repair_completed}'},
					 		handler: function(event, toolEl, panel){
                            	acs_show_win_std('Modifica nota', myApp.railsBaseUri + 'repair_handling_items/edit_notes',
     			                		 {rec_id: <%= @item.id -%>, note_field: 'repair_completed_notes', datetime_field: 'repair_completed_at'},
     			                		 600, 300);					 			 
					 		}				 		
				 		}        	    
        	    ]
        	   }
        	  ]
			  
			} //RIPARATO
		
		


			//CONTAINER RIPORTATO IN TERMINAL
			, {			  			  			
			  items: [
				{html: '<h2>Ritorno in terminal</h2>'},
				{xtype: 'textfield', fieldLabel: 'In terminal il', bind: '{rec.out_garage_at:date("d/m/Y H:i")}'},
				{xtype: 'textfield', fieldLabel: 'In terminal da', bind: '{rec.out_garage_user_name}'}
			  ]
			  
        	  , dockedItems: [
        	   { 
        	    defaults: {scale: 'medium'},        	   
        	    xtype: 'toolbar', dock: 'bottom',
        	    items: [
						{iconCls: '', text: 'Imposta/Modifica', bind: {disabled: '{!enable_operations.out_garage_modify}'}, 
							handler: function(event, toolEl, panel){
							  Ext.MessageBox.confirm('Richieta conferma', 'Confermi operazione?', function(btn){
							   if(btn === 'yes'){
								Ext.Ajax.request({
				                    url: <%= raw url_for(:controller=>'repair_handling_items', :action=>'set_out_garage').to_json -%>,
				                    waitMsg: 'Salvataggio in corso....',
									method:'POST',                     
				                    jsonData: {rec_id: <%= @item.id -%>},	
				             	
									success: function(result, request) {					
										var returnData = Ext.JSON.decode(result.responseText);

										if (returnData.success == false){
											Ext.MessageBox.show({
						                        title: 'EXCEPTION',
						                        msg: returnData.message,
						                        icon: Ext.MessageBox.ERROR,
						                        buttons: Ext.Msg.OK
					                    	})
					                      return false;										
										}
										
										//aggiorno il record per il bind e operation_list
										tab_panel = this.up('container[itemId=tab_panel]');
										rec = returnData.data[0];																				
										tab_panel.getViewModel().setData({rec: rec});
										tab_panel.getViewModel().setData({enable_operations: returnData.enable_operations});
									}, scope: this,
									
									failure: function(rec, op) {
										alert('error');
										var result = Ext.JSON.decode(op.getResponse().responseText);
										Ext.MessageBox.show({
					                        title: 'EXCEPTION',
					                        msg: result.message,
					                        icon: Ext.MessageBox.ERROR,
					                        buttons: Ext.Msg.OK
				                    	})					
									}, scope: this,						
													 
						    	});							   
							   } //btn == 'yes'
							  }, this); 
							 
				 			} //handler
				 		},
				 		{xtype: 'tbfill'},{scale: 'medium', cls: 'btn-ok', iconCls: 'fa fa-2x fa-thumbs-o-up', text: '', 
				 			bind: {visible: '{rec.out_garage_at}'}
				 		}, {scale: 'medium', cls: '', iconCls: '', text: '', bind: {iconCls: '{with_note_out_garage}'},
					 		handler: function(event, toolEl, panel){
                            	acs_show_win_std('Modifica nota', myApp.railsBaseUri + 'repair_handling_items/edit_notes',
     			                		 {rec_id: <%= @item.id -%>, note_field: 'out_garage_notes', datetime_field: 'out_garage_at'},
     			                		 600, 300);					 			 
					 		}				 		
				 		}
        	    ]
        	   }
        	  ]
			  
			} //RIPORTATO IN TERMINAL
	     

	  ]
	} //INTESTAZIONE
	
     
  
  ]
 }
 ]
}